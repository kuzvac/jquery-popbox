(function(){$.fn.popbox=function(e){var t=$.extend({selector:this.selector,open:".open",box:".box",arrow:".arrow",arrow_border:".arrow-border",close:".close",direction:"top"},e);var n={open:function(e){e.preventDefault();var r=$(this);var i=$(this).parent().find(t["box"]);i.find(t["arrow"]).addClass("arrow"+t["direction"]);i.find(t["arrow_border"]).addClass("arrow"+t["direction"]+"-border");if(t["direction"]=="top"||t["direction"]=="bottom"){i.find(t["arrow"]).css({left:i.width()/2-10});i.find(t["arrow_border"]).css({left:i.width()/2-10})}else{i.find(t["arrow"]).css({top:i.height()/2-10});i.find(t["arrow_border"]).css({top:i.height()/2-10})}if(i.css("display")=="block"){n.close()}else{if(t["direction"]=="top"){i.css({display:"block",top:10,left:r.parent().width()/2-i.width()/2})}if(t["direction"]=="left"){console.log(r.parent().width());i.css({display:"block",left:r.parent().width()/2+i.width()/4-10,bottom:r.parent().height()/2-i.height()/2})}if(t["direction"]=="right"){i.css({display:"block",right:r.parent().width()/2+i.width()/4-10,bottom:r.parent().height()/2-i.height()/2})}if(t["direction"]=="bottom"){i.css({display:"block",bottom:10+r.parent().height(),right:r.parent().width()/2-i.width()/2})}}},close:function(){$(t["box"]).fadeOut("fast")}};$(document).bind("keyup",function(e){if(e.keyCode==27){n.close()}});$(document).bind("click",function(e){if(!$(e.target).closest(t["selector"]).length){n.close()}});return this.each(function(){$(this).css({width:$(t["box"]).width()});$(t["open"],this).bind("click",n.open);$(t["open"],this).parent().find(t["close"]).bind("click",function(e){e.preventDefault();n.close()})})}}).call(this)