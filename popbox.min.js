!function(){$.fn.popbox=function(t){var o=$.extend({selector:this.selector,open:".open",box:".box",arrow:".arrow",arrow_border:".arrow-border",close:".close",direction:"bottom"},t),e={open:function(t){t.preventDefault();var i=$(this),r=$(this).parent().find(o.box);r.find(o.arrow).addClass("arrow"+o.direction),r.find(o.arrow_border).addClass("arrow"+o.direction+"-border"),"bottom"==o.direction||"top"==o.direction?(r.find(o.arrow).css({left:r.width()/2-10}),r.find(o.arrow_border).css({left:r.width()/2-10})):(r.find(o.arrow).css({top:r.height()/2-10}),r.find(o.arrow_border).css({top:r.height()/2-10})),"block"==r.css("display")?e.close():("bottom"==o.direction&&r.css({display:"block",top:10,left:i.parent().width()/2-r.width()/2}),"right"==o.direction&&r.css({display:"block",left:i.parent().width()/2+r.width()/4,bottom:i.parent().height()/2-r.height()/2}),"left"==o.direction&&r.css({display:"block",right:i.parent().width()/2+r.width()/4,bottom:i.parent().height()/2-r.height()/2}),"top"==o.direction&&r.css({display:"block",bottom:10+i.parent().height(),right:i.parent().width()/2-r.width()/2}))},close:function(){$(o.box).fadeOut("fast")}};return $(document).bind("keyup",function(t){27==t.keyCode&&e.close()}),$(document).bind("click",function(t){$(t.target).closest(o.selector).length||e.close()}),this.each(function(){$(this).css({width:$(o.box).width()}),$(o.open,this).bind("click",e.open),$(o.open,this).parent().find(o.close).bind("click",function(t){t.preventDefault(),e.close()})})}}();